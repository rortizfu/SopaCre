--create table TBL_RQUESTIONS
--(
--QUE_NID BIGINT PRIMARY KEY IDENTITY(1,1),
--QUE_CDESCRIPTION VARCHAR(550),
--QUE_OSTATE BIT
--)

--GO

--CREATE TABLE  TBL_RANSWERS
--(
--ANS_NID BIGINT PRIMARY KEY IDENTITY(1,1),
--ANS_CDESCRIPTION VARCHAR(550),
--ANS_OSTATE BIT
--)

--GO

--CREATE TABLE TBL_UQUESTIONS_ANSWERS
--(
--QAN_NID BIGINT PRIMARY KEY IDENTITY(1,1),
--QUE_NID BIGINT,
--ANS_NID BIGINT
--)

--go

--create procedure SPR_GET_QUESTION
--@PI_OSTATE BIT = NULL,
--@PI_NOPTION BIGINT = NULL
--AS
--BEGIN

--	IF @PI_NOPTION IS NULL
--	BEGIN
--		SELECT	QUE_NID IdQuestion,
--				QUE_CDESCRIPTION 'Description',
--				QUE_OSTATE Estado
--		FROM TBL_RQUESTIONS 		
--	END
--	ELSE 
--	BEGIN
--		SELECT	QUE_NID IdQuestion,
--				QUE_CDESCRIPTION 'Description',
--				QUE_OSTATE Estado
--		FROM TBL_RQUESTIONS 
--		WHERE QUE_OSTATE = isnull(@PI_OSTATE,1)		
--	END

--END

GO

create procedure SPR_GET_ANSWERS_PREGUNTA
@PI_OSTATE BIT = NULL,
@PI_NOPTION BIGINT = NULL,
@PI_NQUE_NID BIGINT
AS
BEGIN
	IF @PI_NOPTION IS NULL
	BEGIN --Admin
		SELECT	a.ANS_NID IdAnswer,
				a.ANS_CDESCRIPTION 'Description',
				a.ANS_OSTATE 'State',
				qa.que_nid IdQuestion
		FROM TBL_RANSWERS A INNER JOIN 
			dbo.TBL_UQUESTIONS_ANSWERS QA ON A.ANS_NID = QA.ANS_NID
		WHERE QUE_NID = @PI_NQUE_NID
	END
	ELSE 
	BEGIN
		SELECT a.ANS_NID IdAnswer,
			   a.ANS_CDESCRIPTION 'Description',
			   a.ANS_OSTATE 'State',
			   qa.que_nid IdQuestion
		FROM TBL_RANSWERS A INNER JOIN 
			dbo.TBL_UQUESTIONS_ANSWERS QA ON A.ANS_NID = QA.ANS_NID
		WHERE QUE_NID = @PI_NQUE_NID and ANS_OSTATE = isnull(@PI_OSTATE,1)		 
	END

END
GO

